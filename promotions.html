<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Jam Circle Promotions Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script> 
    <style>
        :root {
            --color-purple-primary: rgb(75, 0, 130);
            --color-purple-light: rgb(123, 50, 180);
            --color-white: rgb(255, 255, 255);
            --color-off-white: rgb(248, 249, 250);
            --color-dark-text: rgb(33, 37, 41);
            --color-grey-text: rgb(108, 117, 125);
            --color-input-border: rgb(206, 212, 218);
            --color-google-blue: #4285F4; 
            --color-google-red: #DB4437; 
        }

        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            background-color: var(--color-purple-primary);
            color: var(--color-white);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 1rem auto; padding: 1rem; }
        .form-section, .output-section { background-color: var(--color-off-white); color: var(--color-dark-text); padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); margin-bottom: 2rem; }
        
        h1, h2 { font-family: 'Montserrat', sans-serif; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; color: var(--color-purple-primary); margin-bottom: 1.5rem; }
        h1 { font-size: 2.2rem; text-align: center; color: var(--color-white); margin-bottom: 2rem; }
        h2 { font-size: 1.6rem; } 
        h3.section-subtitle { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--color-dark-text); margin-top: 1.5rem; margin-bottom: 1rem; }
        h4.social-platform-title { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.1rem; color: var(--color-purple-light); margin-top: 1rem; margin-bottom: 0.5rem; }

        label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: var(--color-dark-text); }
        input[type="text"], input[type="date"], input[type="file"], textarea { width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid var(--color-input-border); border-radius: 4px; font-family: 'Montserrat', sans-serif; font-size: 1rem; background-color: var(--color-white); color: var(--color-dark-text); }
        input[type="file"] { padding: 0.5rem; }
        #selectedFilesDisplay { font-size: 0.85rem; color: var(--color-grey-text); margin-top: -0.5rem; margin-bottom: 1rem; min-height: 20px;}
        textarea { min-height: 80px; }

        .button-base { padding: 0.85rem 1.5rem; border: none; border-radius: 50px; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1rem; text-transform: uppercase; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; display: block; width: 100%; margin-top: 0.75rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; }
        .generate-button { background-color: var(--color-purple-primary); color: var(--color-white); margin-top: 1.5rem; }
        .generate-button:hover { background-color: var(--color-purple-light); transform: translateY(-2px); }
        
        .google-button { margin-top: 0.5rem; font-size: 0.9rem; padding: 0.7rem 1.2rem;}
        .google-drive-button { background-color: var(--color-google-blue); color: var(--color-white); }
        .google-drive-button:hover { background-color: #3a78d8; }
        .google-photos-button { background-color: var(--color-google-red); color: var(--color-white); }
        .google-photos-button:hover { background-color: #c73a2f; }


        /* Poster Styles */
        .poster-preview-container { margin-top: 2rem; }
        .poster-container { max-width: 600px; margin: 0 auto; border: none; background-color: var(--color-purple-primary); color: var(--color-white); box-shadow: 0 5px 25px rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; padding: 2rem; text-align: center; }
        .poster-header-title { font-family: 'Montserrat', sans-serif; font-weight: 400; text-transform: uppercase; letter-spacing: 1px; color: var(--color-off-white); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .poster-event-name-title { font-family: 'Montserrat', sans-serif; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-white); font-size: 2.8rem; line-height: 1.2; margin-top: 0; margin-bottom: 1.5rem; }
        .poster-tagline-text { font-family: 'Montserrat', sans-serif; color: var(--color-off-white); font-style: normal; font-weight: 400; font-size: 1.1rem; margin-bottom: 2rem; }
        .poster-image-section { margin-top: 1.5rem; margin-bottom: 2rem; background-color: var(--color-purple-light); border-radius: 8px; padding: 10px; min-height: 200px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; }
        .poster-collage-image { max-width: calc(50% - 10px); max-height: 200px; border-radius: 4px; object-fit: cover; border: 2px solid var(--color-white); }
        .poster-collage-image.count-1 { max-width: 90%; max-height: 300px;}
        .poster-collage-image.count-2 { max-width: calc(50% - 10px); max-height: 200px;}
        .poster-collage-image.count-3 { max-width: calc(33.33% - 10px); max-height: 150px;}
        .poster-collage-image.count-4 { max-width: calc(50% - 10px); max-height: 180px;}
        .poster-collage-image.count-gt-4 { max-width: calc(33.33% - 10px); max-height: 130px;}
        .poster-details-text p, .poster-ticket-info p { font-family: 'Montserrat', sans-serif; color: var(--color-white); font-weight: 400; font-size: 1.1rem; margin-bottom: 0.75rem; }
        .poster-details-text strong { font-weight: 700; }
        .poster-cta-button { font-family: 'Montserrat', sans-serif; background-color: var(--color-white); color: var(--color-purple-primary); padding: 0.75rem 1.8rem; border: none; border-radius: 50px; text-decoration: none; font-weight: 700; display: inline-block; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 1.5rem; font-size: 1rem; transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease; }
        .poster-cta-button:hover { background-color: var(--color-off-white); color: var(--color-purple-light); transform: scale(1.05); }
        .poster-footer p { font-family: 'Montserrat', sans-serif; color: var(--color-off-white); font-weight: 400; font-size: 0.9rem; margin-top: 1rem; }
        
        /* Social Media Output */
        .social-media-item { margin-bottom: 2rem; background-color: var(--color-white); padding: 1rem; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); }
        .social-image-preview { max-width: 180px; max-height: 135px; border: 1px solid var(--color-input-border); margin-bottom: 0.75rem; object-fit: cover; border-radius: 4px; display: block; }
        .social-output-text { margin-top: 0.5rem; padding: 1rem; background-color: var(--color-off-white); border: 1px solid var(--color-input-border); border-radius: 4px; white-space: pre-wrap; font-family: 'Menlo', 'Monaco', 'Courier New', monospace; font-size: 0.85rem; max-height: 250px; overflow-y: auto; color: var(--color-dark-text); }
        .social-note { font-size: 0.8rem; color: var(--color-grey-text); margin-top: 0.75rem; font-style: italic; line-height: 1.4; }
        
        @media (min-width: 768px) { .form-output-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; } .form-section { margin-bottom: 0; } }
        @media (min-width: 1024px) { .form-output-grid { grid-template-columns: 450px 1fr; } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Jam Circle Promotions Generator</h1>

        <div class="form-output-grid">
            <div class="form-section">
                <h2>Event Details</h2>
                <form id="eventForm">
                    <div>
                        <label for="eventName">Event Name:</label>
                        <input type="text" id="eventName" name="eventName" value="Galway Jam Circle" required>
                    </div>
                    <div>
                        <label for="venue">Venue:</label>
                        <input type="text" id="venue" name="venue" value="The Crane Bar" required>
                    </div>
                    <div>
                        <label for="eventDate">Event Date:</label>
                        <input type="date" id="eventDate" name="eventDate" required>
                    </div>
                    <div>
                        <label for="eventTime">Event Time:</label>
                        <input type="text" id="eventTime" name="eventTime" value="Every Wednesday, 8 PM" required>
                    </div>
                    <div>
                        <label for="tagline">Short Description/Theme:</label>
                        <input type="text" id="tagline" name="tagline" value="All welcome! Bring your instruments & good vibes.">
                    </div>
                    
                    <div>
                        <label>Upload Images:</label>
                        <input type="file" id="imageFiles" name="imageFiles" multiple accept="image/*" style="margin-bottom: 0.5rem;">
                        <button type="button" id="googleDriveButton" class="button-base google-drive-button" disabled>Select from Google Drive</button>
                        <button type="button" id="googlePhotosButton" class="button-base google-photos-button" disabled>Select from Google Photos</button>
                        <div id="selectedFilesDisplay">No images selected. (Google buttons will enable after API loads & you sign in)</div>
                    </div>

                    <div>
                        <label for="features">Featured Instruments/Genres (comma-separated):</label>
                        <textarea id="features" name="features" placeholder="Acoustic, Folk, Trad, Blues, Guitars, Fiddles, Bodhráns"></textarea>
                    </div>
                    <div>
                        <label for="ticketInfo">Entry/Cover Charge:</label>
                        <input type="text" id="ticketInfo" name="ticketInfo" value="Free Entry / Donation based">
                    </div>
                    <div>
                        <label for="contactInfo">Contact Info (Optional):</label>
                        <input type="text" id="contactInfo" name="contactInfo" value="galwayjam@example.com">
                    </div>
                    <button type="button" class="generate-button button-base" onclick="generatePromotions()">Generate Promotions</button>
                </form>
            </div>

            <div class="output-section">
                <h2>Generated Promotions</h2>
                <div id="posterOutput" class="poster-preview-container">
                    <h3 class="section-subtitle">Poster Preview</h3>
                    <div class="poster-container" id="posterContainerContent">
                        <p style="color: var(--color-white);">Enter details and click "Generate" to see the poster.</p>
                    </div>
                </div>
                <div id="socialMediaOutputSection">
                    <h3 class="section-subtitle">Social Media Posts</h3>
                    <div id="socialMediaContent">
                        <p style="color: var(--color-dark-text);">Press "Generate" to see social media post suggestions.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- IMPORTANT NOTE FOR GOOGLE PICKER API ---
        // For the Google Drive/Photos buttons to work, this HTML file MUST be served via a web server
        // (e.g., using Python's http.server, VS Code Live Server, or hosted on GitHub Pages).
        // It WILL NOT WORK if you open the file directly using a file:/// URL due to browser security (CORS).
        // Also, ensure your API_KEY, CLIENT_ID are correct and "Authorized JavaScript origins"
        // in your Google Cloud Console OAuth Client ID settings match the origin you are using.
        // --- END IMPORTANT NOTE ---

        // --- USER CONFIGURATION REQUIRED ---
        const API_KEY = 'AIzaSyA2_4BP7Qv6JYIONCg2KJ6upr2VbaNojkw'; 
        const CLIENT_ID = '786809892671-cpohg98fo9vuf75756qgp0lc4laq43ka.apps.googleusercontent.com'; 
        // --- END USER CONFIGURATION ---

        const DRIVE_SCOPE = 'https://www.googleapis.com/auth/drive.readonly';
        const PHOTOS_SCOPE = 'https://www.googleapis.com/auth/photoslibrary.readonly'; // Scope for Photos Library API
        
        let gapiInited = false; // For gapi.client.init
        let gisInited = false; // For google.accounts.id.initialize
        let pickerApiLoaded = false;
        let tokenClient; // For GIS token requests
        let currentAccessToken = null; // Store the GIS access token
        let selectedImageUrls = []; 

        console.log("Script start - GIS Auth Update"); 

        function gapiLoad() {
            console.log("gapiLoad called");
            gapi.load('client:picker', initializeGapiClient); // Load client for API calls and picker
        }

        function initializeGapiClient() {
            console.log("initializeGapiClient called");
            if (API_KEY === 'YOUR_GOOGLE_API_KEY') {
                alert("API_KEY is not set in the script."); return;
            }
            gapi.client.init({ // This is for API calls, not auth. Auth is handled by GIS.
                apiKey: API_KEY,
                // discoveryDocs are not strictly needed for Picker if views are used, but can be for other GAPI calls
                // discoveryDocs: [ 
                //     'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',
                //     'https://photoslibrary.googleapis.com/$discovery/rest?version=v1'
                // ] 
            }).then(() => {
                console.log("gapi.client.init successful (for API calls, not auth)");
                gapiInited = true;
                pickerApiLoaded = true; // Picker is loaded with 'client:picker'
                // Enable buttons if GIS is also ready (or will be soon)
                checkEnablePickerButtons(); 
            }).catch(error => {
                console.error("Error initializing gapi.client (for API calls):", JSON.stringify(error, Object.getOwnPropertyNames(error)), error);
                alert("Error initializing Google API client structure. Check console.");
            });
        }

        function gisLoad() {
            console.log("gisLoad (Google Identity Services) called");
            if (CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com') {
                 alert("CLIENT_ID is not set in the script."); return;
            }
            try {
                google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: handleCredentialResponse, // Optional: for One Tap or Sign In With Google button
                    // auto_select: true, // Optional: for smoother auto sign-in
                    // ux_mode: "popup", // Optional
                });
                console.log("Google Identity Services initialized");
                gisInited = true;

                // Create token client for Picker
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: `${DRIVE_SCOPE} ${PHOTOS_SCOPE}`, // Scopes needed for Picker
                    callback: (tokenResponse) => { // Callback for when token is received or error
                        if (tokenResponse && tokenResponse.access_token) {
                            currentAccessToken = tokenResponse.access_token;
                            console.log("GIS Access Token obtained:", currentAccessToken ? "Yes" : "No");
                            // Now that we have a token, we can enable picker buttons
                            enablePickerButtons(true);
                        } else {
                            currentAccessToken = null;
                            enablePickerButtons(false);
                            console.error("GIS Token Response error or no access_token:", tokenResponse);
                            alert("Could not get Google authorization. Please try signing in again.");
                        }
                    },
                    error_callback: (error) => {
                        console.error("GIS initTokenClient error_callback:", JSON.stringify(error, Object.getOwnPropertyNames(error)), error);
                        alert("Error during Google authorization process. Check console.");
                        currentAccessToken = null;
                        enablePickerButtons(false);
                    }
                });
                checkEnablePickerButtons(); // Check if we can enable buttons (user might be already signed in)
                // Attempt to get a token silently if user is already signed in with Google
                // This might not always work depending on user's session status with Google
                // google.accounts.id.prompt(); // This would show One Tap if configured
            } catch (error) {
                 console.error("Error initializing Google Identity Services (GIS):", error);
                 alert("Critical error initializing Google Sign-In services. Check console.");
            }
        }
        
        // This callback is for Google One Tap or Sign In With Google button, not directly used by Picker token flow
        function handleCredentialResponse(response) {
            console.log("GIS handleCredentialResponse (e.g., from One Tap):", response);
            // If using One Tap or Sign In With Google button, you'd handle the ID token here.
            // For Picker, we primarily use the access token from initTokenClient.
            // However, a successful sign-in here means user is authenticated.
            // We might need to re-request an access token for Picker if it's not already available.
            if (response.credential) {
                 // User is signed in, we can now try to get an access token for Picker
                requestAccessTokenForPicker();
            }
        }

        function requestAccessTokenForPicker() {
            if (tokenClient) {
                console.log("Requesting access token for Picker...");
                tokenClient.requestAccessToken({prompt: ''}); // prompt: '' for silent, or 'consent' if needed
            } else {
                console.error("Token client not initialized for Picker token request.");
            }
        }


        function enablePickerButtons(enable) {
            document.getElementById('googleDriveButton').disabled = !enable;
            document.getElementById('googlePhotosButton').disabled = !enable;
            const filesDisplay = document.getElementById('selectedFilesDisplay');
            if (enable) {
                 if(filesDisplay.textContent.includes('Sign in to Google') || filesDisplay.textContent.includes('No images selected')) {
                    filesDisplay.textContent = 'No images selected. Google services ready.';
                }
            } else {
                if(filesDisplay.textContent.includes('Google services ready') || filesDisplay.textContent.includes('No images selected')) {
                     filesDisplay.textContent = 'No images selected. (Sign in to Google to enable Drive/Photos buttons)';
                }
            }
        }

        function checkEnablePickerButtons() {
            // Buttons should be enabled if both GAPI (for picker) and GIS (for token) are ready,
            // and we have an access token (or can get one).
            // For simplicity, we enable them if GIS is init and user can be prompted for token.
            if (gisInited) { // Primarily depends on GIS being ready to request a token
                enablePickerButtons(true); // User will be prompted if no token yet
            }
        }
        
        function createPicker(type) {
            console.log("createPicker called for type:", type); 
            if (!pickerApiLoaded) { // Check if picker API specifically is ready
                alert("Google Picker API not loaded yet. Please wait and try again.");
                return;
            }

            if (!currentAccessToken) {
                console.log("No current access token for Picker. Requesting...");
                requestAccessTokenForPicker(); 
                // User will need to click again after token is obtained if it wasn't silent.
                // Or, we could chain this to open picker after token.
                alert("Authorizing with Google... Please click the button again after authorization completes.");
                return;
            }
            
            console.log("Proceeding to createPickerView with token:", currentAccessToken ? "Yes" : "No");
            createPickerView(type);
        }

        function createPickerView(type) {
            // ... (Picker view creation logic remains largely the same) ...
            console.log("createPickerView called for type:", type); 
            let view;
            let title = 'Select Images';
            if (type === 'drive') {
                title = 'Select an image from Google Drive';
                view = new google.picker.View(google.picker.ViewId.DOCS_IMAGES);
            } else if (type === 'photos') {
                title = 'Select from Google Photos';
                view = new google.picker.View(google.picker.ViewId.PHOTOS);
            } else { console.error("Unknown picker type:", type); return; }

            const picker = new google.picker.PickerBuilder()
                .enableFeature(google.picker.Feature.NAV_HIDDEN) 
                .setAppId(CLIENT_ID.split('.')[0]) 
                .setOAuthToken(currentAccessToken) // Use GIS obtained token
                .addView(view)
                .setDeveloperKey(API_KEY) // API Key is still needed for Picker
                .setCallback(pickerCallback)
                .setTitle(title)
                .setMaxItems(6 - document.getElementById('imageFiles').files.length) 
                .build();
            picker.setVisible(true);
            console.log("Picker should be visible now."); 
        }

        function pickerCallback(data) {
            // ... (pickerCallback logic remains the same) ...
            console.log("pickerCallback data:", data); 
            try {
                if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
                    const docs = data[google.picker.Response.DOCUMENTS];
                    console.log("Picked documents:", docs); 
                    docs.forEach(doc => {
                        let imageUrl = doc.url; 
                        if (!imageUrl && doc.thumbnails && doc.thumbnails.length > 0) {
                            imageUrl = doc.thumbnails[doc.thumbnails.length - 1].url;
                            if (imageUrl) imageUrl = imageUrl.replace(/=s\d+(-c)?$/, '=s0'); 
                        }
                        if (doc.serviceId === 'photos' && imageUrl && !imageUrl.endsWith('-d')) {
                             console.log("Google Photos URL picked:", imageUrl);
                        }

                        if (imageUrl && !selectedImageUrls.includes(imageUrl)) {
                            selectedImageUrls.push(imageUrl);
                        } else if (!imageUrl) {
                            console.warn("Could not get a usable image URL from picker for doc:", doc);
                        }
                    });
                    updateSelectedFilesDisplay();
                } else if (data[google.picker.Response.ACTION] == google.picker.Action.CANCEL) {
                    console.log('Google Picker Canceled');
                }
            } catch (error) {
                 console.error("Error in pickerCallback:", error);
            }
        }
        
        function updateSelectedFilesDisplay() {
            // ... (updateSelectedFilesDisplay logic remains the same) ...
            const localFiles = Array.from(document.getElementById('imageFiles').files);
            const display = document.getElementById('selectedFilesDisplay');
            let fileNames = [];
            localFiles.forEach(file => fileNames.push(`Local: ${file.name.substring(0,20)}...`));
            const validSelectedImageUrls = selectedImageUrls.filter(url => url);
            validSelectedImageUrls.forEach((url, index) => {
                let name = `Cloud Image ${index + 1}`;
                try {
                    const urlObj = new URL(url);
                    const pathParts = urlObj.pathname.split('/');
                    const potentialName = pathParts[pathParts.length -1];
                    if (potentialName && potentialName.length > 3) { name = potentialName; }
                } catch (e) { /* ignore */ }
                fileNames.push(`Cloud: ${name.substring(0,30)}...`);
            });
            if (fileNames.length > 0) {
                display.textContent = `${fileNames.length} image(s) selected: ${fileNames.join('; ')}`;
            } else {
                 // Check GIS readiness for the message
                 if (gisInited && tokenClient) { // A more accurate check for GIS readiness
                    display.textContent = 'No images selected. Google services ready.';
                } else {
                    display.textContent = 'No images selected. (Initializing Google services...)';
                }
            }
             console.log("Updated selected files display:", display.textContent); 
        }

        document.addEventListener('DOMContentLoaded', function() {
            // ... (DOMContentLoaded logic remains the same) ...
            console.log("DOMContentLoaded event"); 
            // handleClientLoad(); // gapi.load will be called by gisLoad's onload
            // Instead of handleClientLoad, we set up a window.onload for gisLoad
            // and gapiLoad will be called after GIS script is loaded.

            const gisScript = document.querySelector('script[src="https://accounts.google.com/gsi/client"]');
            if (gisScript) {
                gisScript.onload = () => {
                    console.log("Google Identity Services SCRIPT loaded.");
                    gisLoad(); // Initialize GIS
                    gapiLoad(); // Initialize GAPI for Picker (after GIS script is confirmed loaded)
                };
            } else {
                 console.error("GIS script tag not found!");
            }


            try {
                const today = new Date();
                let nextWednesday = new Date(today);
                const dayOfWeek = today.getDay();
                let daysUntilWednesday = (3 - dayOfWeek + 7) % 7;
                if (daysUntilWednesday === 0 && today.getHours() >= 12) { 
                    daysUntilWednesday = 7; 
                }
                nextWednesday.setDate(today.getDate() + daysUntilWednesday);
                
                console.log("Before<y_bin_46> calculation. nextWednesday is:", nextWednesday.toString()); 
                const<y_bin_46> = nextWednesday.getFullYear(); 
                console.log("After<y_bin_46> calculation.<y_bin_46> is:",<y_bin_46>); 

                const mm = String(nextWednesday.getMonth() + 1).padStart(2, '0');
                const dd = String(nextWednesday.getDate()).padStart(2, '0');
                const dateInput = document.getElementById('eventDate');
                if (dateInput) {
                    dateInput.value = `${yyyy}-${mm}-${dd}`; 
                } else {
                    console.error("Element with ID 'eventDate' not found.");
                }
                
                const featuresInput = document.getElementById('features');
                if (featuresInput) {
                    featuresInput.value = "Acoustic, Folk, Trad, Blues, Guitars, Fiddles, Bodhráns";
                } else {
                     console.error("Element with ID 'features' not found.");
                }

                const imageFilesInput = document.getElementById('imageFiles');
                if (imageFilesInput) {
                    imageFilesInput.addEventListener('change', updateSelectedFilesDisplay);
                } else {
                    console.error("Element with ID 'imageFiles' not found.");
                }
            } catch (e) {
                console.error("Error specifically within DOMContentLoaded's date logic or element access:", e);
                const selectedFilesDisplay = document.getElementById('selectedFilesDisplay');
                if (selectedFilesDisplay) {
                    selectedFilesDisplay.textContent = 'Error in page setup. Check console.';
                }
            }
            console.log("DOMContentLoaded event - END"); 
        });

        function formatDate(dateStr) { 
            // ... (same as before) ...
            if (!dateStr) return "TBC";
            try {
                const dateObj = new Date(dateStr + 'T00:00:00');
                return dateObj.toLocaleDateString('en-IE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            } catch (e) { console.error("Error formatting date:", e); return dateStr; }
        }

        function escapeForHTML(str) {
            // ... (same as before) ...
            if (typeof str !== 'string') return str;
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;')
                      .replace(/`/g, '&#96;');
        }

        // generatePromotions is kept extremely simple for debugging 
        async function generatePromotions() {
            console.log("generatePromotions (ULTRA SIMPLE - DEBUGGING) function called.");
            alert("Generate Promotions button clicked! If you see this, the script is loading without syntax errors, and generatePromotions is defined.");
            
            try {
                 const eventNameValue = document.getElementById('eventName').value || "Default Event";
                 const escapedEventName = escapeForHTML(eventNameValue); 

                 document.getElementById('posterContainerContent').innerHTML = `<p style="color:white; font-size:1.5rem;">Poster for: ${escapedEventName} (Debug Mode)</p>`;
                 document.getElementById('socialMediaContent').innerHTML = `<p>Social media for: ${escapedEventName} (Debug Mode)</p>`;
                 console.log("Simplified generatePromotions executed.");
            } catch (e) {
                console.error("Error in simplified generatePromotions:", e);
                alert("Error in simplified generatePromotions. Check console.");
            }
        }
        console.log("Script end"); 
    </script>

</body>
</html>
