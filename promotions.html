<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Jam Circle Promotions Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        :root {
            --color-purple-primary: rgb(75, 0, 130);
            --color-purple-light: rgb(123, 50, 180);
            --color-white: rgb(255, 255, 255);
            --color-off-white: rgb(248, 249, 250);
            --color-dark-text: rgb(33, 37, 41);
            --color-grey-text: rgb(108, 117, 125);
            --color-input-border: rgb(206, 212, 218);
            --color-google-blue: #4285F4; /* Google's Blue */
            --color-google-red: #DB4437; /* Google's Red */
        }

        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            background-color: var(--color-purple-primary);
            color: var(--color-white);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 1rem auto; padding: 1rem; }
        .form-section, .output-section { background-color: var(--color-off-white); color: var(--color-dark-text); padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); margin-bottom: 2rem; }
        
        h1, h2 { font-family: 'Montserrat', sans-serif; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; color: var(--color-purple-primary); margin-bottom: 1.5rem; }
        h1 { font-size: 2.2rem; text-align: center; color: var(--color-white); margin-bottom: 2rem; }
        h2 { font-size: 1.6rem; } 
        h3.section-subtitle { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.4rem; color: var(--color-dark-text); margin-top: 1.5rem; margin-bottom: 1rem; }
        h4.social-platform-title { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.1rem; color: var(--color-purple-light); margin-top: 1rem; margin-bottom: 0.5rem; }

        label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: var(--color-dark-text); }
        input[type="text"], input[type="date"], input[type="file"], textarea { width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid var(--color-input-border); border-radius: 4px; font-family: 'Montserrat', sans-serif; font-size: 1rem; background-color: var(--color-white); color: var(--color-dark-text); }
        input[type="file"] { padding: 0.5rem; }
        #selectedFilesDisplay { font-size: 0.85rem; color: var(--color-grey-text); margin-top: -0.5rem; margin-bottom: 1rem; min-height: 20px;}
        textarea { min-height: 80px; }

        .button-base { padding: 0.85rem 1.5rem; border: none; border-radius: 50px; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1rem; text-transform: uppercase; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; display: block; width: 100%; margin-top: 0.75rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; }
        .generate-button { background-color: var(--color-purple-primary); color: var(--color-white); margin-top: 1.5rem; }
        .generate-button:hover { background-color: var(--color-purple-light); transform: translateY(-2px); }
        
        .google-button { margin-top: 0.5rem; font-size: 0.9rem; padding: 0.7rem 1.2rem;}
        .google-drive-button { background-color: var(--color-google-blue); color: var(--color-white); }
        .google-drive-button:hover { background-color: #3a78d8; }
        .google-photos-button { background-color: var(--color-google-red); color: var(--color-white); }
        .google-photos-button:hover { background-color: #c73a2f; }


        /* Poster Styles */
        .poster-preview-container { margin-top: 2rem; }
        .poster-container { max-width: 600px; margin: 0 auto; border: none; background-color: var(--color-purple-primary); color: var(--color-white); box-shadow: 0 5px 25px rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; padding: 2rem; text-align: center; }
        .poster-header-title { font-family: 'Montserrat', sans-serif; font-weight: 400; text-transform: uppercase; letter-spacing: 1px; color: var(--color-off-white); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .poster-event-name-title { font-family: 'Montserrat', sans-serif; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-white); font-size: 2.8rem; line-height: 1.2; margin-top: 0; margin-bottom: 1.5rem; }
        .poster-tagline-text { font-family: 'Montserrat', sans-serif; color: var(--color-off-white); font-style: normal; font-weight: 400; font-size: 1.1rem; margin-bottom: 2rem; }
        .poster-image-section { margin-top: 1.5rem; margin-bottom: 2rem; background-color: var(--color-purple-light); border-radius: 8px; padding: 10px; min-height: 200px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; }
        .poster-collage-image { max-width: calc(50% - 10px); max-height: 200px; border-radius: 4px; object-fit: cover; border: 2px solid var(--color-white); }
        .poster-collage-image.count-1 { max-width: 90%; max-height: 300px;}
        .poster-collage-image.count-2 { max-width: calc(50% - 10px); max-height: 200px;}
        .poster-collage-image.count-3 { max-width: calc(33.33% - 10px); max-height: 150px;}
        .poster-collage-image.count-4 { max-width: calc(50% - 10px); max-height: 180px;}
        .poster-collage-image.count-gt-4 { max-width: calc(33.33% - 10px); max-height: 130px;}
        .poster-details-text p, .poster-ticket-info p { font-family: 'Montserrat', sans-serif; color: var(--color-white); font-weight: 400; font-size: 1.1rem; margin-bottom: 0.75rem; }
        .poster-details-text strong { font-weight: 700; }
        .poster-cta-button { font-family: 'Montserrat', sans-serif; background-color: var(--color-white); color: var(--color-purple-primary); padding: 0.75rem 1.8rem; border: none; border-radius: 50px; text-decoration: none; font-weight: 700; display: inline-block; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 1.5rem; font-size: 1rem; transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease; }
        .poster-cta-button:hover { background-color: var(--color-off-white); color: var(--color-purple-light); transform: scale(1.05); }
        .poster-footer p { font-family: 'Montserrat', sans-serif; color: var(--color-off-white); font-weight: 400; font-size: 0.9rem; margin-top: 1rem; }
        
        /* Social Media Output */
        .social-media-item { margin-bottom: 2rem; background-color: var(--color-white); padding: 1rem; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); }
        .social-image-preview { max-width: 180px; max-height: 135px; border: 1px solid var(--color-input-border); margin-bottom: 0.75rem; object-fit: cover; border-radius: 4px; display: block; }
        .social-output-text { margin-top: 0.5rem; padding: 1rem; background-color: var(--color-off-white); border: 1px solid var(--color-input-border); border-radius: 4px; white-space: pre-wrap; font-family: 'Menlo', 'Monaco', 'Courier New', monospace; font-size: 0.85rem; max-height: 250px; overflow-y: auto; color: var(--color-dark-text); }
        .social-note { font-size: 0.8rem; color: var(--color-grey-text); margin-top: 0.75rem; font-style: italic; line-height: 1.4; }
        
        @media (min-width: 768px) { .form-output-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; } .form-section { margin-bottom: 0; } }
        @media (min-width: 1024px) { .form-output-grid { grid-template-columns: 450px 1fr; } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Jam Circle Promotions Generator</h1>

        <div class="form-output-grid">
            <div class="form-section">
                <h2>Event Details</h2>
                <form id="eventForm">
                    <div>
                        <label for="eventName">Event Name:</label>
                        <input type="text" id="eventName" name="eventName" value="Galway Jam Circle" required>
                    </div>
                    <div>
                        <label for="venue">Venue:</label>
                        <input type="text" id="venue" name="venue" value="The Crane Bar" required>
                    </div>
                    <div>
                        <label for="eventDate">Event Date:</label>
                        <input type="date" id="eventDate" name="eventDate" required>
                    </div>
                    <div>
                        <label for="eventTime">Event Time:</label>
                        <input type="text" id="eventTime" name="eventTime" value="Every Wednesday, 8 PM" required>
                    </div>
                    <div>
                        <label for="tagline">Short Description/Theme:</label>
                        <input type="text" id="tagline" name="tagline" value="All welcome! Bring your instruments & good vibes.">
                    </div>
                    
                    <div>
                        <label>Upload Images:</label>
                        <input type="file" id="imageFiles" name="imageFiles" multiple accept="image/*" style="margin-bottom: 0.5rem;">
                        <button type="button" id="googleDriveButton" class="button-base google-drive-button">Select from Google Drive</button>
                        <button type="button" id="googlePhotosButton" class="button-base google-photos-button">Select from Google Photos</button>
                        <div id="selectedFilesDisplay">No images selected.</div>
                    </div>

                    <div>
                        <label for="features">Featured Instruments/Genres (comma-separated):</label>
                        <textarea id="features" name="features" placeholder="Acoustic, Folk, Trad, Blues, Guitars, Fiddles, Bodhráns"></textarea>
                    </div>
                    <div>
                        <label for="ticketInfo">Entry/Cover Charge:</label>
                        <input type="text" id="ticketInfo" name="ticketInfo" value="Free Entry / Donation based">
                    </div>
                    <div>
                        <label for="contactInfo">Contact Info (Optional):</label>
                        <input type="text" id="contactInfo" name="contactInfo" value="galwayjam@example.com">
                    </div>
                    <button type="button" class="generate-button button-base" onclick="generatePromotions()">Generate Promotions</button>
                </form>
            </div>

            <div class="output-section">
                <h2>Generated Promotions</h2>
                <div id="posterOutput" class="poster-preview-container">
                    <h3 class="section-subtitle">Poster Preview</h3>
                    <div class="poster-container" id="posterContainerContent">
                        <p style="color: var(--color-white);">Enter details and click "Generate" to see the poster.</p>
                    </div>
                </div>
                <div id="socialMediaOutputSection">
                    <h3 class="section-subtitle">Social Media Posts</h3>
                    <div id="socialMediaContent">
                        <p style="color: var(--color-dark-text);">Press "Generate" to see social media post suggestions.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- USER CONFIGURATION REQUIRED ---
        // TODO: Replace with your own API Key and Client ID from Google Cloud Console
        const API_KEY = 'YOUR_GOOGLE_API_KEY'; // Replace this!
        const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com'; // Replace this!
        // --- END USER CONFIGURATION ---

        const DRIVE_SCOPE = 'https://www.googleapis.com/auth/drive.readonly';
        const PHOTOS_SCOPE = 'https://www.googleapis.com/auth/photoslibrary.readonly'; // Note: Picker might not directly use Photos API scope in the same way.
        
        let gapiLoaded = false;
        let pickerApiLoaded = false;
        let oauthToken = null;
        let selectedImageUrls = []; // Store URLs from both local and Google Picker

        function handleClientLoad() {
            gapi.load('client:auth2:picker', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: `${DRIVE_SCOPE} ${PHOTOS_SCOPE}`, // Request both scopes
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest', 'https://photoslibrary.googleapis.com/$discovery/rest?version=v1'],
            }).then(() => {
                gapiLoaded = true;
                pickerApiLoaded = true; // Picker is loaded as part of 'client:auth2:picker'

                // Listen for sign-in state changes.
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                // Handle the initial sign-in state.
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

                document.getElementById('googleDriveButton').onclick = () => createPicker('drive');
                document.getElementById('googlePhotosButton').onclick = () => createPicker('photos');

            }).catch(error => {
                console.error("Error initializing Google API client:", error);
                alert("Could not initialize Google services. Please ensure API Key and Client ID are correct and APIs are enabled.");
            });
        }

        function updateSigninStatus(isSignedIn) {
            const driveButton = document.getElementById('googleDriveButton');
            const photosButton = document.getElementById('googlePhotosButton');
            if (isSignedIn) {
                oauthToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
                driveButton.disabled = false;
                photosButton.disabled = false;
            } else {
                oauthToken = null;
                driveButton.disabled = true;
                photosButton.disabled = true;
                // Optionally, prompt user to sign in or handle sign-in automatically
                 console.log("User not signed in to Google. Picker buttons disabled.");
                 // To auto-sign-in: gapi.auth2.getAuthInstance().signIn();
            }
        }
        
        function createPicker(type) {
            if (!gapiLoaded || !pickerApiLoaded) {
                alert("Google API not loaded yet. Please wait and try again.");
                return;
            }
            if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
                gapi.auth2.getAuthInstance().signIn().then(() => {
                     if(gapi.auth2.getAuthInstance().isSignedIn.get()) createPickerView(type); // Retry after sign-in
                });
                return; // Don't proceed if not signed in
            }
            createPickerView(type);
        }


        function createPickerView(type) {
            let view;
            let title;

            if (type === 'drive') {
                title = 'Select an image from Google Drive';
                view = new google.picker.View(google.picker.ViewId.DOCS);
                view.setMimeTypes("image/png,image/jpeg,image/jpg,image/gif"); // Show only images
            } else if (type === 'photos') {
                title = 'Select from Google Photos';
                // For Google Photos, it's often better to use the dedicated Photos view if available
                // or fall back to a more general approach if the specific Photos view isn't working as expected.
                // The google.picker.ViewId.PHOTOS is a general one.
                // For more specific albums/photos: google.picker.PhotosView()
                view = new google.picker.View(google.picker.ViewId.PHOTOS);
                view.setMimeTypes("image/png,image/jpeg,image/jpg,image/gif");
            } else {
                console.error("Unknown picker type:", type);
                return;
            }

            const picker = new google.picker.PickerBuilder()
                .enableFeature(google.picker.Feature.NAV_HIDDEN) // Optional: hide navigation
                .setAppId(CLIENT_ID.split('.')[0]) // AppId is usually the numeric part of client ID
                .setOAuthToken(oauthToken)
                .addView(view)
                .setDeveloperKey(API_KEY)
                .setCallback(pickerCallback)
                .build();
            picker.setVisible(true);
        }

        function pickerCallback(data) {
            if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
                const docs = data[google.picker.Response.DOCUMENTS];
                docs.forEach(doc => {
                    if (doc.url) { // Direct URL, often for Photos or publicly shared Drive items
                        selectedImageUrls.push(doc.url);
                    } else if (doc.thumbnails && doc.thumbnails.length > 0) {
                        // Use the largest available thumbnail if no direct URL
                        // Thumbnails might be lower resolution
                        selectedImageUrls.push(doc.thumbnails[doc.thumbnails.length - 1].url);
                    } else if (doc.id && doc.serviceId === 'drive') {
                        // For Drive files, if only ID is returned, you'd typically need another API call
                        // to get a webContentLink or webViewLink. For simplicity, we'll try to use what Picker gives.
                        // This might require enabling "Allow users to access Google Drive with the Drive SDK API" in Drive settings.
                        // A common pattern is to construct a view link if a direct image URL isn't available.
                        // For this example, we'll log it and user might need to ensure file is shareable or use direct image types.
                        console.warn("Google Drive file selected without direct URL. ID:", doc.id, "Ensure it's an image and accessible.");
                        // A temporary solution: try to guess a thumbnail link (not reliable for all files)
                        // Or, you could fetch the webContentLink using gapi.client.drive.files.get with fields='webContentLink,webViewLink'
                        // selectedImageUrls.push(`https://lh3.googleusercontent.com/d/${doc.id}=s0`); // Example, might not work
                    }
                    // Add more sophisticated handling for Drive file IDs if needed
                });
                updateSelectedFilesDisplay();
            }
        }
        
        function updateSelectedFilesDisplay() {
            const localFiles = Array.from(document.getElementById('imageFiles').files);
            const display = document.getElementById('selectedFilesDisplay');
            let fileNames = [];

            localFiles.forEach(file => fileNames.push(`Local: ${file.name}`));
            selectedImageUrls.forEach((url, index) => {
                // Try to derive a name or just use index for Google Picker files
                let name = `Google File ${index + 1}`;
                try {
                    const urlObj = new URL(url);
                    const pathParts = urlObj.pathname.split('/');
                    name = pathParts[pathParts.length -1] || name;
                } catch (e) {}
                fileNames.push(`Cloud: ${name.substring(0,30)}...`);
            });
            
            if (fileNames.length > 0) {
                display.textContent = `${fileNames.length} image(s) selected: ${fileNames.join(', ')}`;
            } else {
                display.textContent = 'No images selected.';
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            handleClientLoad(); // Load Google API Client

            const today = new Date();
            let nextWednesday = new Date(today);
            nextWednesday.setDate(today.getDate() + (3 - today.getDay() + 7) % 7); 
             if (today.getDay() === 3 && today.getHours() > 12) { 
                 nextWednesday.setDate(today.getDate() + 7);
            } else if (today.getDay() === 3 && today.getHours() <=12) {
                nextWednesday.setDate(today.getDate());
            }
            const yyyy = nextWednesday.getFullYear();
            const mm = String(nextWednesday.getMonth() + 1).padStart(2, '0');
            const dd = String(nextWednesday.getDate()).padStart(2, '0');
            document.getElementById('eventDate').value = `${yyyy}-${mm}-${dd}`;
            
            document.getElementById('features').value = "Acoustic, Folk, Trad, Blues, Guitars, Fiddles, Bodhráns";

            const imageFilesInput = document.getElementById('imageFiles');
            imageFilesInput.addEventListener('change', updateSelectedFilesDisplay);
        });

        function formatDate(dateStr) { /* ... (same as before) ... */ }

        async function generatePromotions() {
            const details = { /* ... (same as before, get form values) ... */ };
            details.date_str = formatDate(details.date_str_input);
            const featuresArray = details.features_raw ? details.features_raw.split(',').map(f => f.trim()).filter(f => f) : [];
            details.features = featuresArray.length > 0 ? featuresArray : ["All genres welcome", "Friendly atmosphere", "BYO Instrument"];
            
            // --- Image File Handling ---
            const localImageFiles = document.getElementById('imageFiles').files;
            const localImagePromises = [];
            const maxCollageImages = 6; 
            
            // Process local files
            for (let i = 0; i < localImageFiles.length; i++) {
                const file = localImageFiles[i];
                localImagePromises.push(new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (event) => resolve(event.target.result);
                    reader.onerror = (error) => reject(error);
                    reader.readAsDataURL(file);
                }));
            }

            let localImageDataUrls = [];
            try {
                localImageDataUrls = await Promise.all(localImagePromises);
            } catch (error) {
                console.error("Error reading local image files:", error);
            }

            // Combine local and Google Picker URLs, ensuring no duplicates if a user re-selects
            const allImageUrls = [...new Set([...localImageDataUrls, ...selectedImageUrls])];
            const finalCollageUrls = allImageUrls.slice(0, maxCollageImages);
            // --- End Image File Handling ---

            let posterPrimaryImageUrlForSocial = finalCollageUrls.length > 0 ? finalCollageUrls[0] : '';
            const defaultEventNamePlaceholder = encodeURIComponent(details.eventName.substring(0,25).replace(/\s+/g, '+'));
            
            if (!posterPrimaryImageUrlForSocial) { 
                 posterPrimaryImageUrlForSocial = `https://placehold.co/800x600/4B0082/FFFFFF?text=${defaultEventNamePlaceholder}&font=montserrat`;
            }
            const fallbackImageUrl = `https://placehold.co/800x600/6A0DAD/FFFFFF?text=Image+Not+Found&font=montserrat`;

            // --- Generate Collage HTML ---
            let collageHtml = '';
            if (finalCollageUrls.length > 0) {
                const imgCountClass = `count-${finalCollageUrls.length > 4 ? 'gt-4' : finalCollageUrls.length}`;
                finalCollageUrls.forEach(dataUrl => {
                    collageHtml += `<img src="${dataUrl}" alt="Collage image for ${details.eventName}" class="poster-collage-image ${imgCountClass}" onerror="this.src='${fallbackImageUrl}';">`;
                });
            } else {
                collageHtml = `<img src="${posterPrimaryImageUrlForSocial || fallbackImageUrl}" alt="Placeholder for ${details.eventName}" class="poster-collage-image count-1">`;
            }
            // --- End Generate Collage HTML ---

            const posterHtml = `
                <header style="margin-bottom: 1rem;">
                    <h1 class="poster-header-title">Open Music Session</h1>
                    <h2 class="poster-event-name-title">${details.eventName}</h2>
                    <p class="poster-tagline-text">"${details.tagline}"</p>
                </header>
                <section class="poster-image-section" id="posterCollageContainer">
                    ${collageHtml}
                </section>
                <section class="poster-details-text" style="margin-bottom: 1.5rem;">
                    <p><strong style="font-weight: 700;">WHERE:</strong> ${details.venue}, Galway</p>
                    <p><strong style="font-weight: 700;">WHEN:</strong> ${details.date_str}</p>
                    <p><strong style="font-weight: 700;">TIME:</strong> ${details.time_str}</p>
                </section>
                <section class="poster-ticket-info" style="margin-bottom: 1.5rem;">
                    <p>${details.ticket_info}</p>
                    ${details.ticket_info.toLowerCase().includes("free") ? '' : '<a href="#" class="poster-cta-button">More Info</a>'}
                </section>
                <footer class="poster-footer" style="padding-top: 1rem;">
                    <p>Bring your instruments, voice, or just come to listen!</p>
                    ${details.contact_info ? `<p style="margin-top: 0.25rem;">Contact: ${details.contact_info}</p>` : ''}
                </footer>
            `;
            document.getElementById('posterContainerContent').innerHTML = posterHtml;

            // Generate Social Media Posts
            const socialMediaContentEl = document.getElementById('socialMediaContent');
            socialMediaContentEl.innerHTML = ''; 

            const imageCopyInstructions = "<strong>To use images:</strong> For the poster, take a screenshot. For social media, upload your chosen image(s) directly. You can right-click/long-press on individual images in the collage preview to save them.";
            const commonHashtags = `#GalwayJamCircle #GalwayMusic #LiveMusicGalway #OpenMicGalway #GalwayEvents #CommunityMusic #${(details.venue || "GalwayVenue").replace(/\s+/g, "")}`;
            
            const socialPreviewImageUrl = posterPrimaryImageUrlForSocial || fallbackImageUrl;

            // Instagram, Facebook, Twitter text generation (same as before, using socialPreviewImageUrl)
            // ... (omitted for brevity, but it's the same logic as your previous version) ...
            // Make sure to replace `posterImageUrl` in those text generations with `socialPreviewImageUrl`

            // Example for Instagram (ensure this structure is repeated for Facebook & Twitter)
            const featuresListInsta = details.features.slice(0, 3).map(f => `🎶 ${f}`).join("\n");
            const instagramText = `🎸 **${details.eventName} is ON!** 🥁 ... (rest of text) ... ${commonHashtags}`.trim();
             socialMediaContentEl.innerHTML += `
                <div class="social-media-item">
                    <h4 class="social-platform-title">Instagram Post:</h4>
                    <img src="${socialPreviewImageUrl}" alt="Social media preview for ${details.eventName}" class="social-image-preview" onerror="this.style.display='none'; this.alt='Image preview unavailable.';">
                    <div class="social-output-text">${instagramText}</div>
                    <p class="social-note">${imageCopyInstructions}<br>Remember to upload your image(s) when posting!</p>
                </div>
            `;
            // ... (Repeat for Facebook and Twitter, using socialPreviewImageUrl) ...
             // Facebook
            const featuresBulletsFb = details.features.map(f => `✔️ ${f}`).join("\n");
            const facebookText = `🎉 **${details.eventName} - Join the Jam!** 🎉

"${details.tagline}"

Get ready for a great night of music and fun at ${details.venue}! Whether you play, sing, or just love live music, come on down.

${featuresBulletsFb ? `**What to expect:**\n${featuresBulletsFb}\n` : ''}
🗓️ **Date:** ${details.date_str}
🕒 **Time:** ${details.time_str}
🏛️ **Venue:** ${details.venue}, Galway
💸 **Entry:** ${details.ticket_info}

${details.contact_info ? `For more info, contact: ${details.contact_info}\n` : ''}
Share with your music-loving friends! Let's make some noise! 🎶
${commonHashtags}`.trim();

            socialMediaContentEl.innerHTML += `
                <div class="social-media-item">
                    <h4 class="social-platform-title">Facebook Post:</h4>
                    <img src="${socialPreviewImageUrl}" alt="Social media preview for ${details.eventName}" class="social-image-preview" onerror="this.style.display='none'; this.alt='Image preview unavailable.';">
                    <div class="social-output-text">${facebookText}</div>
                    <p class="social-note">${imageCopyInstructions}<br>Remember to upload your image(s) when posting!</p>
                </div>
            `;
            
            // Twitter
            const shortTaglineTwitter = details.tagline.length > 60 ? details.tagline.substring(0, 57) + "..." : details.tagline;
            const twitterText = `Jammin' in Galway! 🎶
✨ ${details.eventName} ✨
"${shortTaglineTwitter}"
📍 ${details.venue}
📅 ${details.date_str}, ${details.time_str}
Entry: ${details.ticket_info}
${commonHashtags.split(' ').slice(0,4).join(' ')} #Galway`.trim();

            socialMediaContentEl.innerHTML += `
                <div class="social-media-item">
                    <h4 class="social-platform-title">Twitter (X) Post:</h4>
                    <img src="${socialPreviewImageUrl}" alt="Social media preview for ${details.eventName}" class="social-image-preview" onerror="this.style.display='none'; this.alt='Image preview unavailable.';">
                    <div class="social-output-text">${twitterText}</div>
                     <p class="social-note">${imageCopyInstructions}<br>Remember to upload your image(s) when posting!</p>
                </div>
            `;

            // Clear selected Google image URLs after generation to avoid re-adding them on next click without new selection
            selectedImageUrls = []; 
        }
        // Ensure formatDate is defined (it was in your previous script)
        // function formatDate(dateStr) { ... } 
    </script>

</body>
</html>
